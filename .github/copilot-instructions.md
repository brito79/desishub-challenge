# Desishub Candidate Assessment Platform - AI Coding Agent Instructions

## Project Overview
Full-stack skill assessment platform built for Desishub to categorize technical candidates into 5 tiers (0-4) based on their proficiency in web development technologies.

## Architecture & Key Patterns

### Database: MongoDB Native Driver (NO ORM)
- **Never suggest Prisma, Mongoose, or any ORM** - this project uses the native MongoDB driver directly
- Connection pattern uses singleton with HMR-safe global caching (see `lib/db/mongodb.ts`)
- All database operations in `lib/db/candidates.ts` use native MongoDB methods (`insertOne`, `findOne`, `updateOne`, etc.)
- Collection name constant: `COLLECTIONS.CANDIDATES` from `lib/db/mongodb.ts`

```typescript
// Correct pattern for DB operations
const db = await getDb();
const collection = db.collection<Candidate>(COLLECTIONS.CANDIDATES);
const result = await collection.findOne({ email });
```

### Tech Stack Specifics
- **Next.js 16** with App Router (not Pages Router)
- **TypeScript strict mode** - all code must be fully typed
- **No API routes** - use Server Actions for backend logic (convention not yet implemented but preferred)
- **shadcn/ui** (New York style) - always use existing components from `components/ui/` before creating custom ones
- **React Hook Form + Zod** - all forms must use this combo for validation
- **Tailwind CSS v4** with CSS variables for theming

### Path Aliases
```typescript
"@/*" // maps to root (e.g., @/lib, @/components, @/types)
```

## Critical Patterns & Conventions

### 1. Tier Calculation Logic (NEVER MODIFY WITHOUT CONTEXT)
The tier assignment algorithm in `lib/tier-calculator.ts` implements specific business rules:
- Tier 4: Knows Golang + can build Go APIs
- Tier 3: Backend frameworks (Express/Hono/Laravel) + auth APIs, no Golang
- Tier 2: Authentication in Next.js, no backend frameworks
- Tier 1: CRUD apps, no authentication
- Tier 0: HTML/CSS/JS + React/Next.js basics, no CRUD

**Always call `calculateTier(assessment)` - never manually set tier values**

### 2. Type Safety
- All types defined in `types/index.ts`
- Use `Candidate` for new records, `CandidateWithId` for MongoDB results
- Assessment fields are booleans and string arrays - never change to enums or numbers
- Zod schemas in `lib/validations.ts` mirror TypeScript types exactly

### 3. Component Structure (shadcn/ui)
- UI primitives: `components/ui/*` (auto-generated by shadcn CLI)
- Feature components: `components/forms/*`, `components/dashboard/*`, `components/layout/*`
- **Never modify shadcn components directly** - wrap them in feature components
- Always import from `@/components/ui/...`

### 4. Error Handling
- Use `AppError` class from `lib/errors.ts` for business logic errors
- Use `formatErrorResponse()` for consistent API error shapes
- Database errors should be caught and transformed to user-friendly messages

### 5. Styling Conventions
- Use Tailwind utility classes, not custom CSS
- Tier colors defined in `TIER_COLORS` constant (`lib/constants.ts`)
- Responsive: mobile-first approach
- Color scheme uses CSS variables (see `app/globals.css`)

## Development Workflows

### Adding shadcn/ui Components
```bash
npx shadcn@latest add <component-name>
# Components auto-install to components/ui/
```

### Database Schema Changes
- No migrations needed (MongoDB is schemaless)
- Update TypeScript types in `types/index.ts`
- Update Zod schemas in `lib/validations.ts`
- Update database operations in `lib/db/candidates.ts`

### Form Creation Pattern
1. Define Zod schema in `lib/validations.ts`
2. Create form component in `components/forms/`
3. Use React Hook Form with `@hookform/resolvers/zod`
4. Use shadcn `<Form>` components for consistent styling

```typescript
const form = useForm<AssessmentInput>({
  resolver: zodResolver(assessmentSchema),
  defaultValues: { /* ... */ }
});
```

## Project-Specific Rules

### Multi-Step Form (Registration Flow)
- 6 steps: Registration → Basic Skills → CRUD → Auth → Backend → Advanced
- Step names in `ASSESSMENT_STEPS` constant
- Use `<Progress>` component to show completion
- Store form state in React state or URL params, NOT localStorage

### Dashboard Filters
- Filter interface: `DashboardFilters` in `types/index.ts`
- Tier filter values: `'all' | 0 | 1 | 2 | 3 | 4`
- Sorting fields: `'name' | 'email' | 'tier' | 'createdAt'`
- Search queries use MongoDB `$regex` with case-insensitive flag

### Environment Variables
Required in `.env.local`:
- `MONGODB_URI` - MongoDB connection string
- `MONGODB_DB_NAME` - Database name (default: "desishub")
- `NEXT_PUBLIC_APP_URL` - App URL for client-side usage

## Anti-Patterns to Avoid

❌ **Don't** use `mongoose` or Prisma schemas  
✅ **Do** use native MongoDB driver with TypeScript interfaces

❌ **Don't** create API routes in `app/api/`  
✅ **Do** use Server Actions (async functions with `'use server'`)

❌ **Don't** manually calculate tiers in components  
✅ **Do** always use `calculateTier()` from `lib/tier-calculator.ts`

❌ **Don't** use inline styles or custom CSS classes  
✅ **Do** use Tailwind utilities and shadcn components

❌ **Don't** validate forms without Zod  
✅ **Do** use schemas from `lib/validations.ts`

## Key Files Reference

- **Database operations**: `lib/db/candidates.ts`
- **Business logic**: `lib/tier-calculator.ts`
- **Validation schemas**: `lib/validations.ts`
- **Type definitions**: `types/index.ts`
- **Constants**: `lib/constants.ts` (frameworks, colors, tiers)
- **Error handling**: `lib/errors.ts`

## Future Routes (Not Yet Built)
- `/` - Landing page
- `/register` - Multi-step registration + assessment
- `/results/[id]` - Assessment results
- `/dashboard` - All candidates table
- `/candidates/[id]` - Individual candidate details
